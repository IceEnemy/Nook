<script>
    import {onMount, onDestroy} from 'svelte';
    import {authHandlers, showModal} from '$lib/store/store';
    import {auth}  from '$lib/firebase/firebase.js';
    import { goto } from '$app/navigation';
    import {authStore} from '$lib/store/store.js';


    let username = '';
    let profilePic = '';
    // onMount(() => {
    //     // const unsubscribe = auth.onAuthStateChanged((user) => {
    //     //     if (user) {
    //     //         // User is signed in, access displayName here
    //     //         username = user.displayName || 'Fallback Username';
    //     //         profilePic = user.photoURL || 'https://via.placeholder.com/150';
    //     //         // Navigate or perform actions as needed
    //     //     } else {
    //     //         // User is signed out
    //     //         goto('/auth');
    //     //     }
    //     // });

    //     // setContext('userInfo', {username, profilePic})

        
    //     const unsubscribe = authStore.subscribe((val) => {
    //         username = val.data.username || 'Loading..';
    //         profilePic = val.data.profilePic || 'https://via.placeholder.com/150';
    //     })

    //     return () => unsubscribe();
    // });

    $: username = $authStore.data?.username || 'Loading..';
    $: profilePic = $authStore.data?.profilePic || 'https://via.placeholder.com/150';

    function showAcc(){
        showModal.set(true);
    }
</script>

<nav class="navbar">
    <svg width="120" viewBox="0 0 160 55" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path class = 'logo' fill-rule="evenodd" clip-rule="evenodd" d="M151.688 0H142.953L124.562 21.9512C121.596 12.248 112.612 5.19531 101.991 5.19531C89.749 5.19531 79.6826 14.5645 78.498 26.5605H71.1709C69.9326 14.6211 59.8926 5.3125 47.6904 5.3125C37.6963 5.3125 29.1533 11.5566 25.708 20.375L8.73535 0.117188H7.08301H0V52.5293H7.08301V8.75781L21.1816 25.9551L23.373 28.8027L24.0879 29.6133C24.3848 42.4648 34.8379 52.791 47.6904 52.791C59.9805 52.791 70.0781 43.3477 71.1963 31.2832H78.4961C79.668 43.291 89.7402 52.6738 101.991 52.6738C114.066 52.6738 124.024 43.5586 125.43 31.7969L128.197 28.5684L130.13 26.207H130.204L132.66 23.209L151.396 52.2031L160 52.2285L141.783 24.1094L141.799 24.0996L137.49 17.3184L151.688 0ZM98.6855 20.3047C92.665 20.3047 87.5215 24.082 85.4707 29.4062L85.4648 28.9355C85.4648 19.6992 92.9004 12.2773 101.991 12.2773C111.081 12.2773 118.518 19.6992 118.518 28.9355C118.518 35.4434 114.823 41.0527 109.46 43.7949C110.631 42.416 111.545 40.8105 112.128 39.0527C112.597 37.6367 112.851 36.123 112.851 34.5488C112.851 26.6816 106.509 20.3047 98.6855 20.3047ZM41.8096 44.6211C39.3135 42.0547 37.7744 38.541 37.7744 34.666C37.7744 26.7988 44.1162 20.4219 51.9395 20.4219C57.1318 20.4219 61.6719 23.2305 64.1387 27.4199C63.3242 18.957 56.2383 12.3945 47.6904 12.3945C38.5996 12.3945 31.1641 19.8164 31.1641 29.0527C31.1641 36.1855 35.6006 42.2383 41.8096 44.6211ZM63.7275 50.7656C64.2607 50.3848 64.7773 49.9824 65.2764 49.5586C66.0225 48.9238 66.7295 48.2441 67.3916 47.5234C68.5068 48.1738 69.7646 48.6855 71.1426 49.0156C72.375 49.3105 73.7031 49.459 75.1123 49.4316C77.9082 49.3789 80.3604 48.6445 82.3555 47.4746C83.4658 48.6719 84.6982 49.7559 86.0322 50.7031C83.0586 52.793 79.3037 54.0742 75.2021 54.1523C72.71 54.2012 70.3281 53.7988 68.1582 53.0332C66.5508 52.4648 65.0605 51.6973 63.7275 50.7656Z" fill=#c8c8c8/>
        </svg>

        <div class="accountNav">
            <div class="accountCred">
                <img class="imgContainer" src="{profilePic}" alt="">
                <p>{username}</p>
            </div>
            <button class="iconButton" on:click={showAcc} aria-label="Account Settings">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M12 8.25C11.0054 8.25 10.0516 8.64509 9.34835 9.34835C8.64509 10.0516 8.25 11.0054 8.25 12C8.25 12.9946 8.64509 13.9484 9.34835 14.6517C10.0516 15.3549 11.0054 15.75 12 15.75C12.9946 15.75 13.9484 15.3549 14.6517 14.6517C15.3549 13.9484 15.75 12.9946 15.75 12C15.75 11.0054 15.3549 10.0516 14.6517 9.34835C13.9484 8.64509 12.9946 8.25 12 8.25ZM9.75 12C9.75 11.4033 9.98705 10.831 10.409 10.409C10.831 9.98705 11.4033 9.75 12 9.75C12.5967 9.75 13.169 9.98705 13.591 10.409C14.0129 10.831 14.25 11.4033 14.25 12C14.25 12.5967 14.0129 13.169 13.591 13.591C13.169 14.0129 12.5967 14.25 12 14.25C11.4033 14.25 10.831 14.0129 10.409 13.591C9.98705 13.169 9.75 12.5967 9.75 12Z" fill="#EAE9E5"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M11.9748 1.25C11.5298 1.25 11.1588 1.25 10.8548 1.27C10.544 1.28294 10.2376 1.34714 9.94777 1.46C9.61402 1.59809 9.31075 1.80057 9.05526 2.05589C8.79978 2.3112 8.59709 2.61434 8.45877 2.948C8.31377 3.298 8.27477 3.668 8.25877 4.07C8.25717 4.21702 8.21826 4.36123 8.14567 4.48909C8.07308 4.61695 7.9692 4.72428 7.84377 4.801C7.71466 4.8715 7.56974 4.90803 7.42263 4.90716C7.27552 4.90628 7.13104 4.86803 7.00277 4.796C6.64677 4.608 6.30678 4.457 5.93078 4.407C5.57272 4.3599 5.20889 4.38379 4.86007 4.4773C4.51125 4.57081 4.18426 4.73212 3.89777 4.952C3.65555 5.14688 3.44709 5.38034 3.28077 5.643C3.11077 5.897 2.92477 6.218 2.70277 6.603L2.67777 6.647C2.45477 7.032 2.26977 7.353 2.13577 7.627C1.99577 7.913 1.88577 8.195 1.84577 8.507C1.75038 9.22999 1.94605 9.96127 2.38977 10.54C2.62077 10.841 2.92177 11.06 3.26177 11.274C3.38853 11.3489 3.49415 11.4549 3.56867 11.5819C3.64319 11.7089 3.68418 11.8528 3.68777 12C3.68418 12.1472 3.64319 12.2911 3.56867 12.4181C3.49415 12.5451 3.38853 12.6511 3.26177 12.726C2.92177 12.94 2.62177 13.159 2.38977 13.46C2.16989 13.7465 2.00859 14.0735 1.91508 14.4223C1.82157 14.7711 1.79768 15.1349 1.84477 15.493C1.88577 15.805 1.99477 16.087 2.13477 16.373C2.26977 16.647 2.45477 16.968 2.67777 17.353L2.70277 17.397C2.92477 17.782 3.11077 18.103 3.28077 18.357C3.45777 18.62 3.64777 18.857 3.89777 19.047C4.18418 19.2671 4.51114 19.4285 4.85996 19.5222C5.20879 19.6159 5.57265 19.64 5.93078 19.593C6.30678 19.543 6.64677 19.393 7.00277 19.204C7.13089 19.1321 7.27519 19.0939 7.42213 19.093C7.56906 19.0921 7.71381 19.1286 7.84277 19.199C7.96889 19.2751 8.07343 19.3823 8.14642 19.5102C8.21941 19.6382 8.25844 19.7827 8.25978 19.93C8.27478 20.332 8.31378 20.702 8.45977 21.052C8.59786 21.3857 8.80035 21.689 9.05566 21.9445C9.31098 22.2 9.61412 22.4027 9.94777 22.541C10.2378 22.661 10.5378 22.708 10.8548 22.729C11.1588 22.75 11.5298 22.75 11.9748 22.75H12.0248C12.4698 22.75 12.8408 22.75 13.1448 22.73C13.4628 22.708 13.7618 22.661 14.0518 22.54C14.3855 22.4019 14.6888 22.1994 14.9443 21.9441C15.1998 21.6888 15.4025 21.3857 15.5408 21.052C15.6858 20.702 15.7248 20.332 15.7408 19.93C15.7422 19.7828 15.781 19.6384 15.8536 19.5103C15.9262 19.3823 16.0302 19.2748 16.1558 19.198C16.285 19.1276 16.4299 19.0913 16.577 19.0923C16.7242 19.0934 16.8686 19.1318 16.9968 19.204C17.3528 19.392 17.6928 19.543 18.0688 19.592C18.7918 19.6874 19.523 19.4917 20.1018 19.048C20.3518 18.856 20.5418 18.62 20.7188 18.357C20.8888 18.103 21.0748 17.782 21.2968 17.397L21.3218 17.353C21.5448 16.968 21.7298 16.647 21.8638 16.373C22.0038 16.087 22.1138 15.804 22.1538 15.493C22.2492 14.77 22.0535 14.0387 21.6098 13.46C21.3788 13.159 21.0778 12.94 20.7378 12.726C20.611 12.6511 20.5054 12.5451 20.4309 12.4181C20.3564 12.2911 20.3154 12.1472 20.3118 12C20.3118 11.722 20.4638 11.446 20.7378 11.274C21.0778 11.06 21.3778 10.841 21.6098 10.54C21.8297 10.2535 21.991 9.92653 22.0845 9.5777C22.178 9.22888 22.2019 8.86506 22.1548 8.507C22.1072 8.19971 22.0092 7.90238 21.8648 7.627C21.694 7.29475 21.513 6.96792 21.3218 6.647L21.2968 6.603C21.1141 6.27709 20.9213 5.95693 20.7188 5.643C20.5525 5.38062 20.344 5.14749 20.1018 4.953C19.8154 4.73294 19.4884 4.57146 19.1396 4.47778C18.7908 4.38409 18.4269 4.36004 18.0688 4.407C17.6928 4.457 17.3528 4.607 16.9968 4.796C16.8686 4.86786 16.7243 4.90601 16.5774 4.90688C16.4305 4.90776 16.2858 4.87132 16.1568 4.801C16.031 4.72452 15.9267 4.6173 15.8538 4.48942C15.7808 4.36154 15.7416 4.21721 15.7398 4.07C15.7248 3.668 15.6858 3.298 15.5398 2.948C15.4017 2.61425 15.1992 2.31097 14.9439 2.05549C14.6886 1.8 14.3854 1.59731 14.0518 1.459C13.7618 1.339 13.4618 1.292 13.1448 1.271C12.8408 1.25 12.4698 1.25 12.0248 1.25H11.9748ZM10.5218 2.845C10.5988 2.813 10.7158 2.784 10.9568 2.767C11.2038 2.75 11.5238 2.75 11.9998 2.75C12.4758 2.75 12.7958 2.75 13.0428 2.767C13.2838 2.784 13.4008 2.813 13.4778 2.845C13.7848 2.972 14.0278 3.215 14.1548 3.522C14.1948 3.618 14.2278 3.769 14.2408 4.126C14.2708 4.918 14.6798 5.681 15.4058 6.1C16.1318 6.52 16.9968 6.492 17.6978 6.122C18.0138 5.955 18.1608 5.908 18.2648 5.895C18.5933 5.85158 18.9257 5.94043 19.1888 6.142C19.2548 6.193 19.3388 6.28 19.4738 6.48C19.6128 6.686 19.7728 6.963 20.0108 7.375C20.2488 7.787 20.4078 8.065 20.5168 8.287C20.6238 8.504 20.6568 8.62 20.6668 8.703C20.7102 9.03157 20.6213 9.36392 20.4198 9.627C20.3558 9.71 20.2418 9.814 19.9398 10.004C19.2678 10.426 18.8118 11.162 18.8118 12C18.8118 12.838 19.2678 13.574 19.9398 13.996C20.2418 14.186 20.3558 14.29 20.4198 14.373C20.6218 14.636 20.7098 14.968 20.6668 15.297C20.6568 15.38 20.6228 15.497 20.5168 15.713C20.4078 15.936 20.2488 16.213 20.0108 16.625C19.7728 17.037 19.6118 17.314 19.4738 17.52C19.3388 17.72 19.2548 17.807 19.1888 17.858C18.9257 18.0596 18.5933 18.1484 18.2648 18.105C18.1608 18.092 18.0148 18.045 17.6978 17.878C16.9978 17.508 16.1318 17.48 15.4058 17.899C14.6798 18.319 14.2708 19.082 14.2408 19.874C14.2278 20.231 14.1948 20.382 14.1548 20.478C14.092 20.6298 13.9998 20.7677 13.8837 20.8839C13.7675 21.0001 13.6296 21.0922 13.4778 21.155C13.4008 21.187 13.2838 21.216 13.0428 21.233C12.7958 21.25 12.4758 21.25 11.9998 21.25C11.5238 21.25 11.2038 21.25 10.9568 21.233C10.7158 21.216 10.5988 21.187 10.5218 21.155C10.37 21.0922 10.2321 21.0001 10.1159 20.8839C9.99972 20.7677 9.9076 20.6298 9.84478 20.478C9.80478 20.382 9.77177 20.231 9.75877 19.874C9.72877 19.082 9.31977 18.319 8.59377 17.9C7.86777 17.48 7.00278 17.508 6.30177 17.878C5.98577 18.045 5.83878 18.092 5.73478 18.105C5.40621 18.1484 5.07385 18.0596 4.81077 17.858C4.74477 17.807 4.66077 17.72 4.52577 17.52C4.33769 17.2272 4.1586 16.9287 3.98878 16.625C3.75077 16.213 3.59177 15.935 3.48277 15.713C3.37577 15.496 3.34277 15.38 3.33277 15.297C3.28936 14.9684 3.3782 14.6361 3.57977 14.373C3.64377 14.29 3.75777 14.186 4.05977 13.996C4.73177 13.574 5.18778 12.838 5.18778 12C5.18778 11.162 4.73177 10.426 4.05977 10.004C3.75777 9.814 3.64377 9.71 3.57977 9.627C3.3782 9.36392 3.28936 9.03157 3.33277 8.703C3.34277 8.62 3.37677 8.503 3.48277 8.287C3.59177 8.064 3.75077 7.787 3.98878 7.375C4.22677 6.963 4.38777 6.686 4.52577 6.48C4.66077 6.28 4.74477 6.193 4.81077 6.142C5.07385 5.94043 5.40621 5.85158 5.73478 5.895C5.83878 5.908 5.98478 5.955 6.30177 6.122C7.00177 6.492 7.86777 6.52 8.59377 6.1C9.31977 5.681 9.72877 4.918 9.75877 4.126C9.77177 3.769 9.80478 3.618 9.84478 3.522C9.97178 3.215 10.2148 2.972 10.5218 2.845Z" fill="#EAE9E5"/>
                </svg>
            </button>
            
        </div>
</nav>


<style>
    .iconButton {
        background: none; /* Removes the default background */
        border: none; /* Removes the default border */
        padding: 0; /* Removes the default padding */
        cursor: pointer; /* Changes the cursor to a pointer to indicate it's clickable */
        display: flex; /* To center the SVG icon within the button */
        align-items: center; /* Centers the SVG vertically */
        justify-content: center; /* Centers the SVG horizontally */
    }

    /* Optionally, you might want to add styles for when the button is focused or hovered */
    .iconButton:focus {
        outline: none; /* Removes the default focus outline */
        /* Consider adding a custom focus style to maintain accessibility */
    }

    .iconButton:hover {
        fill:var(--lighter_clr);
    }

    .logo{
        fill:var(--lighter_clr);
    }

    .imgContainer{
        width: 2.5rem;
        height: 2.5rem;
    }

    .accountCred{
        display:flex;
        align-items: center;
        gap: 0.5rem;
    }

    .navbar{
        width:18rem;
        height: 100vh;
        padding-left:2rem;
        padding-top: 3rem;
        position:fixed;
        background-color: var(--sec_clr);
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
    }

    .accountNav{
        position: absolute;
        bottom: 0; /* Align to bottom */
        left: 0; /* Align to the left edge of navbar */
        width: 100%; /* Ensure it spans the full width of navbar */
        padding: 1rem; /* Apply padding here, adjust as needed */
        background-color: var(--prim_clr);
        box-sizing: border-box; /* Ensures padding is included in the element's size */
        height:4rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    /* .spin{
        animation: spin 2s infinite;
    }

    @keyframes spin {
        from{
            transform: rotate(0deg);
        }
        to{
            transform: rotate(360deg);
        }
    } */

</style>